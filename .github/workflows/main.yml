name: Update Scholar Stats  # Workflow çš„åç§°

on:
  # 1. å®šæ—¶è§¦å‘ï¼šæ¯å¤©UTCæ—¶é—´å‡Œæ™¨5ç‚¹è¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´13ç‚¹ï¼‰
  schedule:
    - cron: '0 5 * * *'
  # 2. æ‰‹åŠ¨è§¦å‘ï¼šå…è®¸åœ¨ GitHub é¡µé¢ä¸Šæ‰‹åŠ¨ç‚¹å‡»è¿è¡Œ
  workflow_dispatch:
  # 3. æ¨é€è§¦å‘ï¼šå½“ main åˆ†æ”¯æœ‰ä»£ç æ¨é€æ—¶ä¹Ÿè¿è¡Œï¼ˆå¯é€‰ï¼Œç”¨äºæµ‹è¯•ï¼‰
  push:
    branches: [ main ]

jobs:
  update:
    runs-on: ubuntu-latest  # åœ¨æœ€æ–°çš„ Ubuntu ç³»ç»Ÿä¸Šè¿è¡Œ

    steps:
      # æ­¥éª¤1ï¼šæ£€å‡ºä»“åº“ä»£ç 
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}  # ä½¿ç”¨GITHUB_TOKENæ‰æœ‰æƒé™æ¨é€ä»£ç 
          fetch-depth: 0  # è·å–æ‰€æœ‰å†å²è®°å½•

      # æ­¥éª¤2ï¼šè®¾ç½® Python ç¯å¢ƒ
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'  # æŒ‡å®šPythonç‰ˆæœ¬ï¼Œä¸ä½ æœ¬åœ°ä¸€è‡´

      # æ­¥éª¤3ï¼šå®‰è£…ä¾èµ–
      - name: Install dependencies
        run: |
          pip install -r scripts/requirements.txt

      # æ­¥éª¤4ï¼šè¿è¡Œ Python è„šæœ¬æŠ“å–æ•°æ®
      - name: Run scholar script
        run: |
          python scripts/main.py

      # æ­¥éª¤5ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰å˜åŠ¨ï¼Œå¦‚æœæœ‰åˆ™æäº¤
      - name: Commit and push if changed
        run: |
          git config --local user.email "action@github.com"
          git.config --local user.name "GitHub Action"
          git add data/scholar_stats.json  # åªæ·»åŠ æ•°æ®æ–‡ä»¶
          git diff --staged --quiet || (git commit -m "ğŸ¤– Auto-update scholar stats [skip ci]" && git push)
